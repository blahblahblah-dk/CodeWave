<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>대피소 검색</title>
</head>
<body>
  <h1>대피소 검색</h1>
  
  <!-- 지역명 입력 받기 -->
  <label for="region">지역명 입력: </label>
  <input type="text" id="region" placeholder="지역명 입력 (예: 서울특별시)">
  <button onclick="searchShelters()">대피소 검색</button>

  <div id="shelter-list"></div>  <!-- 대피소 리스트가 표시될 영역 -->
  
  <script>
    function searchShelters() {
      const region = document.getElementById('region').value.trim();  // 사용자가 입력한 지역명 가져오기
      if (!region) {
        alert('지역명을 입력해주세요.');
        return;
      }

      // Call the backend proxy endpoint instead of the external API directly
      const backendApiUrl = `/api/shelters?region=${encodeURIComponent(region)}&rows=10&page=1`;

      fetch(backendApiUrl)
        .then(response => {
          if (!response.ok) {
            // Handle HTTP errors from the backend proxy
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log("Data from backend:", data); // Log data received from backend

          // Process the data structure returned by the backend proxy
          // Assuming the backend returns the original structure from safetydata.go.kr
          if (data.response && data.response.header && data.response.header.resultCode === "00") {
            const shelters = data.response.body.items;
            const shelterListDiv = document.getElementById('shelter-list');
            shelterListDiv.innerHTML = '';
            
            if (!shelters || shelters.length === 0) { // Check if shelters is undefined or empty
              shelterListDiv.innerHTML = '<p>대피소 정보가 없습니다.</p>';
            } else {
              shelters.forEach(item => { // Renamed shelter to item to match safetydata response
                const shelterInfo = `
                  <div style="margin-bottom: 15px;">
                    <h3>${item.vt_acmdfclty_nm}</h3> <!-- Use correct field names -->
                    <p>주소: ${item.dtl_adres}</p>
                    <p>수용가능인원: ${item.fclty_ar}명</p>
                    <hr>
                  </div>
                `;
                shelterListDiv.innerHTML += shelterInfo;
              });
            }
          } else {
            const errorMsg = data.response?.header?.resultMsg || data.detail || '알 수 없는 API 오류';
            console.error('API 응답 실패:', errorMsg);
            alert(`대피소 데이터를 가져오는 데 실패했습니다: ${errorMsg}`);
          }
        })
        .catch(error => {
          console.error('API 요청 중 오류가 발생했습니다:', error);
          alert(`대피소 데이터를 가져오는 중 오류가 발생했습니다: ${error.message}`);
        });
    }
  </script>
</body>
</html>

